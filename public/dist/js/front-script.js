var initAddressSuggesters,checkAddress,setupMap,mapsLoaded=!0,mapsWaiting=[],prepareMapFunction=function(e){mapsLoaded?e():mapsWaiting.push(e)};$(document).ready(function(e){setupMap=function(e,t){if(e.find(".suggester-map-div").show(),e.find(".suggester-map-div").attr("inited"))e.find(".suggester-map-div").data("map").panTo(t),e.find(".suggester-map-div").data("marker").setPosition(t);else{var s=new google.maps.Map(e.find(".suggester-map-div")[0],{center:t,zoom:14,backgroundColor:"none"}),n=new google.maps.Marker({map:s,icon:"/assets/images/map-pin-inactive.png",draggable:!0,position:t});n.addListener("dragend",function(t){this.map.panTo(this.getPosition()),(new google.maps.Geocoder).geocode({location:this.getPosition()},function(e,t){if("OK"==t){var s=e[0].formatted_address,n=this.find(".country-select option:selected").text();s=s.replace(", "+n,""),this.find(".address-suggester").val(s).blur()}else checkAddress(null,this)}.bind(e))}),e.find(".suggester-map-div").attr("inited",1),e.find(".suggester-map-div").data("map",s),e.find(".suggester-map-div").data("marker",n)}},initAddressSuggesters=function(){prepareMapFunction(function(){e(".address-suggester").each(function(){if(e(this).hasClass("dont-init"))return!1;var t=e(this).closest(".address-suggester-wrapper");if(t.find(".country-select").change(function(){var t=e(this).find("option:selected").val();d.setComponentRestrictions({country:t})}),t.find(".suggester-map-div").attr("lat")){var s={lat:parseFloat(t.find(".suggester-map-div").attr("lat")),lng:parseFloat(t.find(".suggester-map-div").attr("lon"))};setupMap(t,s)}var n=e(this)[0];if(e("[data-country-code]").length)var a=e("[data-country-code]").attr("data-country-code");else var a=t.find(".country-select option:selected").val();var i={componentRestrictions:{country:a},types:["address"]},d=new google.maps.places.Autocomplete(n,i);d.suggester_container=t,google.maps.event.addListener(d,"place_changed",function(){var e=this.getPlace();this.suggester_container.find(".address-suggester").val(e.formatted_address?e.formatted_address:e.name).blur()}.bind(d)),e(this).blur(function(t){var s=e(this).closest(".address-suggester-wrapper"),n=(s.find(".country-select option:selected").text(),s.find(".country-select option:selected").val()),a=new google.maps.Geocoder,i=e(this).val();a.geocode({address:i,region:n},function(e,t){"OK"==t?checkAddress(e[0],this):checkAddress(null,this)}.bind(s))})})}),e(".address-suggester").on("keyup keypress",function(e){if(13===(e.keyCode||e.which))return e.preventDefault(),!1})},checkAddress=function(e,t){if(t.find(".geoip-hint").hide(),t.find(".geoip-confirmation").hide(),t.find(".suggester-map-div").hide(),e&&e.geometry){var s=t.find(".address-suggester").val(),n=t.find(".country-select option:selected").text();s=s.replace(", "+n,""),t.find(".address-suggester").val(s);var a={lat:e.geometry.location.lat(),lng:e.geometry.location.lng()};return setupMap(t,a),void t.find(".geoip-confirmation").show()}t.find(".geoip-hint").show()},e(".address-suggester").length&&initAddressSuggesters()});